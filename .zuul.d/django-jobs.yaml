- job:
    name: horizon-tox-python3-django
    abstract: true
    parent: horizon-openstack-tox-base
    description: |
      Run tox with different Django version.

      .. zuul:jobvar: tox_envlist

         Which tox environment to run

      .. zuul:jobvar: django_version

         Django version to be used.
         pip version specifier like ``>=1.11,<2.0`` should be passed.

    pre-run: playbooks/horizon-tox-django/pre.yaml
    run: playbooks/horizon-tox-django/run.yaml
    vars:
      tox_envlist: py38
    required-projects:
      - name: openstack/horizon

- job:
    name: horizon-tox-python3-django30
    parent: horizon-tox-python3-django
    vars:
      django_version: '>=3.0,<3.1'

- job:
    name: horizon-tox-python3-django31
    parent: horizon-tox-python3-django
    vars:
      django_version: '>=3.1,<3.2'

- project-template:
    name: horizon-non-primary-django-jobs
    description: |
      Run unit tests with non-primary Django versions.
    check:
      jobs:
        # Currently we only support Django 2.2, so there is no need
        # to run tests with different versions of Django.
        # We specify a job in openstack-python3-wallaby-jobs(-horizon)
        # to keep this project template as it is used in horizon plugins.
        # NOTE: We keep it as a template even though it is not used now.
        - openstack-tox-py38
        - horizon-tox-python3-django30:
            voting: false
        - horizon-tox-python3-django31:
            voting: false
    gate:
      jobs:
        - openstack-tox-py38
        # Skip these until the django3.x jobs become voting.
        # - horizon-tox-python3-django30
        # - horizon-tox-python3-django31
